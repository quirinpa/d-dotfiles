#!/bin/ksh
magnets=$(mktemp /tmp/pir_XXXXXXX)
trap "rm $magnets; exit 1" INT

counter=0
curl -H "Content-Type: text/xml" -s "$(BROWSER=echo sr tpb $@)" | tidy -asxhtml -numeric -utf8 2>/dev/null| xml sel -N n="http://www.w3.org/1999/xhtml" -t -m "//n:td[2]" --var linebreak -n --break -v "translate(n:div[@class='detName']/n:a, \$linebreak, ' ')" -n -v "n:a[1]/@href" -n | while read -r title; do
	echo $counter\) $title
	read -r magnet
	echo $magnet >> $magnets
	let "counter+=1"
done | more

echo -n "download: "
read -r n
IFS=,
for id in $n; do
	transmission-remote -a "$(cat $magnets | sed $(($id + 1))"q;d")"
done
transmission-remote -l
rm $magnets
